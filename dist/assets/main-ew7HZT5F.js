import{A as l}from"./constantes-B-0QMk3S.js";import{l as f}from"./index-BLRFddlS.js";import{l as h}from"./load_navbar-D39noM3e.js";const t=JSON.parse(localStorage.getItem("user")),p=localStorage.getItem("token"),s=f(l,{auth:{token:p,userId:t.id}});Notification.permission!=="granted"&&Notification.requestPermission().then(e=>{console.log("Permiso de notificaciones:",e)});document.addEventListener("DOMContentLoaded",()=>{h();const e=document.getElementById("createRoom"),n=document.getElementById("roomInfo");e==null||e.addEventListener("click",()=>{const o=prompt("Nombre de la sala:");o&&(s.emit("create_room",{room:o,username:t.username}),s.emit("join_room",{sid:t.id,room:o,username:t.username}),window.location.href=`call.html?room=${o}&user=${t.username}_${t.id}`)}),s.on("room_created",({room:o,username:a})=>{Notification.permission==="granted"&&new Notification("üìû Nueva llamada",{body:`${a} ha iniciado una llamada en la sala ${o}`,icon:"/favicon.ico"});const r=document.createElement("div");r.className="bg-green-100 text-green-800 p-2 rounded shadow cursor-pointer hover:bg-green-200",r.textContent=`üìû ${a} ha iniciado una llamada en la sala ${o}`,r.addEventListener("click",()=>{s.emit("join_room",{room:o,username:t.username}),window.location.href=`call.html?room=${o}&user=${a}_${t.id}`}),n&&(n.classList.remove("hidden"),n.innerHTML="",n.appendChild(r))}),s.connect()});document.addEventListener("DOMContentLoaded",async()=>{const e=document.getElementById("callHistory");if(e){const n=await g();console.log(n);for(const{id:o,caller_id:a,receiver_id:r,started_at:u}of n){let c;a==t.id?c=r:c=a;try{const m=await(await fetch(`${l}/users/${c}`)).json(),i=document.createElement("div");i.classList.add("cursor-pointer"),i.addEventListener("click",()=>{window.location.href=`call_detail.html?id=${o}`}),i.className="bg-orange-500 p-3 rounded-lg shadow-sm cursor-pointer",i.innerHTML=`
        <div class="flex items-center gap-3">
          <img src="https://i.pravatar.cc/40?u=${encodeURIComponent(m.username)}" alt="User photo" class="w-10 h-10 rounded-full" />
          <div>
            <p class="text-sm font-medium text-white">${m.username}</p>
            <p class="text-xs text-white">${new Date(u).toLocaleString()}</p>
          </div>
        </div>
      `,e.appendChild(i)}catch(d){console.error("Error al obtener informaci√≥n del usuario:",d)}}}});async function g(){try{const e=await fetch(`${l}/videoCalls/users/${t.id}`);if(!e.ok)throw new Error("Error al obtener historial");return await e.json()}catch(e){console.log("Error al obtener historial de llamadas:",e)}}
